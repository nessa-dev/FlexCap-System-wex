<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlexCap - @ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="~/css/Template.css" asp-append-version="true" />
</head>
<body class="d-flex">
    @{
        var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
        var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
        var isAuthenticated = User?.Identity?.IsAuthenticated == true;
        var isRh = User.IsInRole("HR Manager") || User.IsInRole("HR Analyst") || User.IsInRole("HR Consultant");
        var isManager = User.IsInRole("Project Manager");
        var currentProfile = "Colaborador";
        if (isRh)
        {
            currentProfile = "Rh";
        }
        else if (isManager)
        {
            currentProfile = "Manager";
        }
        Func<string, string, string> GetActive = (controller, action) =>
        {
            return controller == currentController && action == currentAction ? "active" : "";
        };
        string homeActionName = "Colaborador";
        string homeControllerName = "Home";

        if (currentProfile == "Manager")
        {
            homeActionName = "Manager";
        }
        else if (currentProfile == "Rh")
        {
            homeActionName = "Rh";
        }
        bool isHomeActive = currentController == "Home" &&
        (currentAction == "Index" || currentAction == "Manager" || currentAction == "Rh" || currentAction == "Colaborador");
    }





    <div class="sidebar">
        <div>
            <div class="p-3 text-center">
                <img src="~/img/logo.png" alt="FlexCap Logo" class="img-fluid">
            </div>

            <a asp-controller="Home" asp-action="Index" class="menu-item @(isHomeActive ? "active" : "")">
                <span class="material-icons">home</span> Home
            </a>

            @if (currentProfile == "Manager")
            {
                <a asp-controller="Colaboradores" asp-action="ListarEquipe" class="menu-item action @GetActive("Colaboradores", "ListarEquipe")">
                    <span class="material-icons">people</span> Collaborators
                </a>
                <a asp-controller="Sprint" asp-action="Manager" class="menu-item action @GetActive("Sprint", "Manager")">
                    <span class="material-icons">timeline</span> Sprints & Gantt
                </a>
                <a asp-controller="Calendar" asp-action="Manager" class="menu-item action @GetActive("Calendar", "Manager")">
                    <span class="material-icons">calendar_today</span> Corporate Calendar
                </a>
                <a asp-controller="ManagerApproval" asp-action="PendingList"
                   class="menu-item action @GetActive("ManagerApproval", "PendingList")">
                    <span class="material-icons">description</span> Requests
                </a>
            }
            else if (currentProfile == "Rh")
            {
                <a asp-controller="Colaboradores" asp-action="Listar" class="menu-item action @GetActive("Colaboradores", "Listar")">
                    <span class="material-icons">people</span> Collaborators
                </a>
                <a asp-controller="Sprint" asp-action="Rh" class="menu-item action @GetActive("Sprint", "Rh")">
                    <span class="material-icons">timeline</span> Sprints & Gantt
                </a>
                <a asp-controller="Calendar" asp-action="Rh" class="menu-item action @GetActive("Calendar", "Rh")">
                    <span class="material-icons">calendar_today</span> Corporate Calendar
                </a>
                <a asp-controller="HRApproval" asp-action="PendingList"
                   class="menu-item action @GetActive("HRApproval", "PendingList")">
                    <span class="material-icons">description</span> Requests
                </a>
            }
            else if (currentProfile == "Colaborador")
            {
                <a asp-controller="Colaboradores" asp-action="ListarEquipe" class="menu-item action @GetActive("Colaboradores", "ListarEquipe")">
                    <span class="material-icons">people</span> Collaborators
                </a>
                <a asp-controller="Sprint" asp-action="Colaborador" class="menu-item action @GetActive("Sprint", "Colaborador")">
                    <span class="material-icons">timeline</span> Sprints & Gantt
                </a>
                <a asp-controller="Calendar" asp-action="Colaborador" class="menu-item action @GetActive("Calendar", "Colaborador")">
                    <span class="material-icons">calendar_today</span> Corporate Calendar
                </a>
                <a asp-controller="Request" asp-action="Submit"
                   class="menu-item action @GetActive("Request", "Submit")">
                    <span class="material-icons">description</span> Requests
                </a>
            }
        </div>

        <div class="bottom-menu p-3">
            <a asp-controller="Account" asp-action="ChangePassword" class="menu-item">
                <span class="material-icons">vpn_key</span> <span class="text-warning">Change Password</span>
            </a>
            <a asp-controller="Login" asp-action="Logout" class="menu-item">
                <span class="material-icons">logout</span> Log Out
            </a>
        </div>
    </div>

    <div class="main-content-wrapper flex-grow-1 p-4 bg-light">
        @RenderBody()
    </div>

    <!-- jQuery (sempre primeiro) -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery Validation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>

    <!-- jQuery Unobtrusive Validation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js"></script>

    <!-- SEUS scripts personalizados (depois dos de cima) -->
    <script src="~/js/request-hr.js" asp-append-version="true"></script>

    @RenderSection("Scripts", required: false)
</body>
</html>