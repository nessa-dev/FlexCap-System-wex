@model FlexCap.Web.Models.ColaboradorViewModel

@{
    ViewData["Title"] = "Register New Employee";
    Layout = "~/Views/Shared/Template.cshtml";

    var defaultPhotoUrl = "https://placehold.co/120x120/F5F5F5/B0B0B0?text=Photo";
    var currentStatus = Model.Status ?? "Ativo";
    var inactivityReasons = ViewBag.InactivityReasons as SelectList;
}

<div class="py-4"
     style="max-width: 850px;
            width: 100%;
            margin-left: 0.5rem;
            margin-right: auto;
            overflow-y: hidden;
            height: calc(100vh - 5rem);">

    <h4 class="fw-bold mb-3">@ViewData["Title"]</h4>

    <div class="p-4 border rounded shadow-sm h-100">
        <form asp-controller="Registro" asp-action="NovoColaborador" method="post" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="row g-3 align-items-start">
                <!-- Foto e Manager -->
                <div class="col-md-3 text-center">
                    <img id="photo-preview"
                         src="@(Model.PhotoUrl ?? defaultPhotoUrl)"
                         alt="Employee Photo"
                         class="rounded-circle border shadow-sm mb-2"
                         style="width: 120px; height: 120px; object-fit: cover;">

                    <input type="file" id="photoFile" name="PhotoFile"
                           accept="image/*"
                           class="form-control form-control-sm mb-2" />

                    <div class="form-check d-flex justify-content-center align-items-center gap-1">
                        <input class="form-check-input" type="checkbox" id="isManagerCheckbox" name="IsManager" value="true" checked="@Model.IsManager" />
                        <label class="form-check-label small fw-bold" for="isManagerCheckbox">Manager</label>
                    </div>
                </div>

                <!-- Campos principais -->
                <div class="col-md-9">
                    <div class="row g-2">
                        <div class="col-md-6">
                            <label class="form-label">Full Name</label>
                            <input asp-for="FullName" class="form-control mb-0" />
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input asp-for="Email" class="form-control mb-0" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Password</label>
                            <input asp-for="Senha" type="password" class="form-control mb-0" />
                            <span asp-validation-for="Senha" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Position</label>
                            <select asp-for="Position" asp-items="ViewBag.Positions" class="form-select mb-0">
                                <option value="">Select Position</option>
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Department</label>
                            <select asp-for="Department" asp-items="ViewBag.Departments" class="form-select mb-0">
                                <option value="">Select Department</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Team</label>
                            <select asp-for="TeamName" asp-items="ViewBag.Teams" class="form-select mb-0">
                                <option value="">Select Team</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Country</label>
                            <select asp-for="Country" asp-items="ViewBag.Countries" class="form-select mb-0">
                                <option value="">Select Country</option>
                            </select>
                        </div>


                        <style>
                            .form-control,
                            .form-select {
                                margin-bottom: 0 !important;
                            }

                            /* 🔹 Faz o Status subir mais */
                            .status-section {
                                margin-top: -0.5rem !important; /* força o bloco a subir */
                            }

                            /* Mantém o espaçamento dos selects e dos botões corretos */
                            .form-section {
                                margin-bottom: 0 !important;
                            }
                        </style>



                        <!-- Status -->
                        <div class="row g-2 align-items-start">

                            <div class="col-md-6">
                                <label class="form-label d-block small mb-1">Status</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="Status" id="status-ativo" value="Ativo" checked="@("Ativo".Equals(currentStatus))">
                                    <label class="form-check-label small" for="status-ativo">Ativo</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="Status" id="status-inativo" value="Inativo" checked="@("Inativo".Equals(currentStatus))">
                                    <label class="form-check-label small" for="status-inativo">Inativo</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                            </div>

                        </div>

                            <!-- Campos de inatividade -->
                            <div id="inactivity-fields-group" style="display: none; margin-top: 0.5rem;">
                                <hr class="my-2" />
                                <div class="row g-2">
                                    <div class="col-md-4">
                                        <label class="form-label small">Reason for Inactivity</label>
                                        <select class="form-select form-select-sm" name="ReasonForInactivity" id="reasonForInactivity">
                                            <option value="">Select Reason</option>

                                            @if (ViewBag.InactivityReasons != null)
                                            {
                                                @foreach (var item in ViewBag.InactivityReasons as SelectList)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small">Start Date</label>
                                        <input type="date" class="form-control form-control-sm" name="StartDate" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small">End Date</label>
                                        <input type="date" class="form-control form-control-sm" name="EndDate" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Botões -->
                    <div class="mt-4 d-flex justify-content-end gap-2">
                        <a asp-controller="Colaboradores" asp-action="Listar" class="btn btn-outline-secondary px-4">Cancel</a>
                        <button type="submit" class="btn btn-primary px-4">Save</button>
                    </div>
                </div>
            </div>
      
    </div>
</div>

<!-- Preview e lógica de status -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Preview da foto
        const photoInput = document.getElementById('photoFile');
        const preview = document.getElementById('photo-preview');
        photoInput.addEventListener('change', e => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = ev => { preview.src = ev.target.result; };
                reader.readAsDataURL(file);
            }
        });

        // Mostrar campos de inatividade
        const inactiveGroup = document.getElementById('inactivity-fields-group');
        const radioAtivo = document.getElementById('status-ativo');
        const radioInativo = document.getElementById('status-inativo');

        function toggleInactivityFields() {
            inactiveGroup.style.display = radioInativo.checked ? 'block' : 'none';
        }

        radioAtivo.addEventListener('change', toggleInactivityFields);
        radioInativo.addEventListener('change', toggleInactivityFields);
        toggleInactivityFields(); // inicializa
    });
</script>
